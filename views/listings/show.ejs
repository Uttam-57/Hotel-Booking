<% layout('/layout/boilerplate.ejs') %>

    <div class="container mt-5 mb-4 ">
        <div class="Detail">
            <div class="card-body">
                <% if (listing.image) { %>
                    <img src="<%= listing.image.url %>" class="card-img-top img-cover " alt="Listing Image">
                    <% } %>

                        <h1 class="card-title mb-3">
                            <%= listing.title %>
                        </h1>
                        <h5 class="card-subtitle mb-2 text-muted">â‚¹<%= listing.price %>/Night</h5>
                        <p class="card-text "><strong>
                                <%= listing.description %>
                            </strong>

                        </p>
                        <p class="card-text"><strong>Location:</strong>
                            <%= listing.location %>
                        </p>
                        <p class="card-text"><strong>Country:</strong>
                            <%= listing.country %>
                        </p>
                        <p class="card-text"><strong>Owner:</strong>
                            <%= listing.owner.username %>
                        </p>
                        <% if(currentUser && currentUser._id.equals(listing.owner._id)){%>
                            <div class="d-flex gap-2 mb-3">
                                <a href="/listings/<%= listing._id %>/edit" class="btn btn-primary" style="color: #FFFFFF !important;" >Edit</a>
                                <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST"
                                    class="d-inline">
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </form>
                            </div>
                            <% }%>

                                <%if( listing.reviews.length>0) { %>
            </div>
            <h2>Reviews</h2>
            <div class="review">
                <% listing.reviews.forEach(review=> { %>
                    <div class="card   mb-3">
                        <div class="card-body">
                            <h4 class="card-title">@ <%= review.username.username %>
                            </h4>
                            <h5 class="card-text">
                                <p class="starability-result" data-rating="<%= review.rating %>"> </p>
                            </h5>

                            <h5 class="card-text">
                                <p class="card-text">
                                    <%= review.content %>
                                </p>
                            </h5>
                            <p class="card-text"><small class="text-muted">Reviewed on
                                    <%= review.Date.toLocaleDateString() %>
                                </small></p>
                            <% if(currentUser) { %>
                                <form action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE"
                                    method="post" class="d-inline ">
                                    <button type="submit" class="btn btn-danger">Delete Review</button>
                                </form>
                                <% } %>
                        </div>
                    </div>


                    <% }) %>
            </div>
            <% } %>
                <div>
                    <% if(currentUser) { %>
                        <h3> Leave A Review About Hotel</h3>
                        <form action="/listings/<%= listing._id %>/reviews" method="POST" novalidate
                            class="needs-validation">

                            <div>

                                <fieldset class="starability-slot">
                                    <legend>Rating</legend>
                                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]"
                                        value="1" checked aria-label="No rating." />
                                    <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                                    <label for="first-rate1" title="Terrible">1 star</label>
                                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                                    <label for="first-rate2" title="Not good">2 stars</label>
                                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                                    <label for="first-rate3" title="Average">3 stars</label>
                                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                                    <label for="first-rate4" title="Very good">4 stars</label>
                                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                                    <label for="first-rate5" title="Amazing">5 stars</label>
                                </fieldset>
                            </div>
                            <div class="mb-3">
                                <label for="content" class="form-label">Content</label>
                                <textarea class="form-control" id="content" name="review[content]" rows="3"
                                    required></textarea>
                                <div class="invalid-feedback">
                                    Please enter your review content.
                                </div>
                                <div class="valid-feedback">
                                    thanks for your review!
                                </div>
                            </div>
                            <button type="submit" class="btn " style="background-color: #0077B6; color: #FFFFFF;">Submit Review</button>
                        </form>
                        <% } %>
                </div>
                <div class=" card-body mt-3 ">
                    <a href="/listings"class="btn " style="background-color: #0077B6; color: #FFFFFF!important;">Back to All List</a>

                </div>
        </div>
    </div>

    </div>